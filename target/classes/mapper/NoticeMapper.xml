<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="NoticeMapper">
	<select id="getNoticeCount" resultType="_int">
		select count(*) 
		from notice
	</select>
	
	<select id="getNoticeSearchCount" resultType="_int">
		select count(*)
		from notice
		where category = #{category}
		<choose>
			<when test="type=='title_content'">
				and title like '%'||#{searchText}||'%' or content like '%'||#{searchText}||'%'
			</when>
			<otherwise>
				and ${type} like '%'||#{searchText}||'%'
			</otherwise>
		</choose>
	</select>
	
	<select id="getNotices" resultType="NoticeVO">
		select * 
		from (
			select a.*, rownum as r 
			from (
				select * 
				from notice 
				order by notice_number desc
				) a
			) 
		where r between #{start} and #{end} and category = #{category}
	</select>
	
	<select id="getSearchNotices" resultType="NoticeVO">
		select * 
		from ( 
			select a.*, rownum as r 
			from (
				select * 
				from notice 
				<where>
					<choose>
						<when test="type=='title_content'">
							title like '%'||#{searchText}||'%' or content like '%'||#{searchText}||'%'
						</when>
						<otherwise>
							${type} like '%'||#{searchText}||'%'
						</otherwise>
					</choose>
				</where>
				order by notice_number desc
				) a
			) 
		where r between #{start} and #{end} and category = #{category}
	</select>
	
	<insert id="insertNotice">
		insert into notice
		values(notice_number_seq.nextval, #{writer}, sysdate, #{title}, #{content}, #{category}, #filename})
	</insert>
	
	<select id="getNotice" resultType="NoticeVO">
		select * 
		from notice 
		where notice_number = #{notice_number}
	</select>
	
	<update id="updateNotice">
		update notice 
		set title = #{title}, category = #{category}, content = #{content}
		<if test="filename!=null">
			, filename = #{filename}
		</if> 
		where notice_number = #{notice_number}
	</update>
	
	<delete id="deleteNotice">
		delete 
		from notice 
		where notice_number = #{notice_number}
	</delete>
</mapper>